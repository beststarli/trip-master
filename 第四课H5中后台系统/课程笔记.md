# 第四课PC/H5及中后台系统开发——个人记录

## React

### useState

#### 惰性初始化
只在组件首次渲染时执行一次
#### 函数式更新
setState为异步，该方式可以获取上一步的状态，在此基础上进行更新，解决因异步不能获取实时数据的问题

### useEffect
```tsx
useEffect(() => {

})
```
没有依赖数组，在每次组件更新都会执行

```tsx
useEffect(() => {

}, [])
```
空依赖数组，只在组件挂载时执行一次

### 同构
同构是指同一套代码即能在服务端运行，也能在客户端运行

同构组件设计原则：
- 避免在组件顶层使用浏览器API（window、document、localStorage）
- 将浏览器专属代码放在useEffect中
- 使用环境判断：typeof window !== 'undefined'
- 保证服务端和客户端初始渲染结果一致

SSR核心三步流程：
```tsx
第一步：服务端渲染

// 将React组件转换为HTML字符串
const html = ReactDOMServer.renderToString(<App />)
```

```tsx
第二步：嵌入模版返回

<div id='root'>${html}</div>
<script src='/bundle.js'></script>
```

```tsx
第三步：客户端水合

// 复用DOM，绑定事件，使页面可交互
hydrateRoot(document.getElementById('root'), <App />)
```

